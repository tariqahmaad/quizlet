<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Exam Selector</title>
    <!-- Link to the index CSS -->
    <link rel="stylesheet" href="style_index.css">
    <!-- GoatCounter analytics -->
    <script data-goatcounter="https://tariqo.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</head>

<body>
    <div class="container">
        <h1>Select a Course Exam</h1>
        <p>Choose an available course below and enter your name to start.</p>

        <!-- Daily Visitor Counter -->
        <div class="visitor-counter">
            <p>Daily Visitors: <span id="visitor-count">Loading...</span></p>
        </div>

        <div class="course-grid">

            <!-- Parallel Programming - Available -->
            <div class="course-item available course-link" data-href="quiz.html?course=COM478"
                title="Start Parallel Programming Exam">
                <h2>PARALLEL PROGRAMMING</h2>
                <p class="course-code">COM478</p>
                <span>Start Exam</span>
            </div>

            <!-- Cyber Security - Available -->
            <div class="course-item available course-link" data-href="quiz.html?course=COM496"
                title="Start Cyber Security Exam">
                <h2>CYBER SECURITY</h2>
                <p class="course-code">COM496</p>
                <span>Start Exam</span>
            </div>


            <!-- Entrepreneurship - Available -->
            <div class="course-item available course-link" data-href="quiz.html?course=GRI403"
                title="Start Entrepreneurship Exam">
                <h2>ENTREPRENEURSHIP</h2>
                <p class="course-code">GRI403</p>
                <span>Start Exam</span>
            </div>

            <!-- Special Topics - Not Available -->
            <div class="course-item unavailable" title="Exam not yet available for Special Topics">
                <h2>SPECIAL TOPICS IN COMPUTER ENGINEERING</h2>
                <p class="course-code">COM476</p>
                <span>Exam Coming Soon</span>
            </div>

            <!-- Natural Language Processing - Not Available -->
            <div class="course-item unavailable" title="Exam not yet available for Natural Language Processing">
                <h2>NATURAL LANGUAGE PROCESSING</h2>
                <p class="course-code">COM494</p>
                <span>Exam Coming Soon</span>
            </div>


        </div>

    </div>

    <!-- Player Name Input Modal -->
    <div id="player-modal" class="modal-overlay">
        <div class="modal-content">
            <span class="modal-close-btn" onclick="closeModal()">Ã—</span>
            <h2>Enter Your Name</h2>
            <p>Please enter your name to start the exam.</p>
            <input type="text" id="modal-player-name" placeholder="Your Name" maxlength="20">
            <p id="modal-error" class="modal-error-message"></p>
            <button id="modal-start-btn">Start Exam</button>
            <!-- Hidden input to store the target URL -->
            <input type="hidden" id="modal-target-url">
        </div>
    </div>

    <script src="leaderboard_api.js"></script>
    <script src="index_script.js"></script>

    <!-- Visitor Counter Script - Using exact code from documentation -->
    <script>
        console.log('Visitor counter script started.');
        let t1 = null; // Declare t1 outside
        let goatcounterInitialized = false;

        // Function to fetch the count
        function fetchGoatCounterCount(path) {
            if (!path) {
                console.error('GoatCounter path is empty or undefined!');
                document.querySelector('#visitor-count').innerText = 'Error (path)';
                return; // Stop if path is invalid
            }

            let requestUrl = 'https://tariqo.goatcounter.com/counter/' + encodeURIComponent(path) + '.json';
            console.log('Requesting URL:', requestUrl);

            let r = new XMLHttpRequest();
            r.addEventListener('load', function () {
                console.log('XHR request finished with status:', this.status);
                if (this.status === 200) {
                    try {
                        let data = JSON.parse(this.responseText);
                        console.log('GoatCounter response data:', data);
                        document.querySelector('#visitor-count').innerText = data.count;
                    } catch (e) {
                        console.error('Error parsing GoatCounter JSON response:', e);
                        document.querySelector('#visitor-count').innerText = 'Error (parse)';
                    }
                } else {
                    console.error('GoatCounter JSON request failed:', this.status, this.statusText, 'Response:', this.responseText);
                    document.querySelector('#visitor-count').innerText = 'N/A (' + this.status + ')';
                }
            });

            r.addEventListener('error', function () {
                console.error('XHR request network error occurred.');
                document.querySelector('#visitor-count').innerText = 'Error (network)';
            });

            r.open('GET', requestUrl);
            r.send();
        }

        // JSON counter for the text display
        t1 = setInterval(function () {
            console.log('Checking for window.goatcounter...');
            if (window.goatcounter) {
                console.log('window.goatcounter object FOUND.');
                if (window.goatcounter.get_data) {
                    console.log('window.goatcounter.get_data method FOUND.');
                    clearInterval(t1);
                    goatcounterInitialized = true;
                    fetchGoatCounterCount(window.goatcounter.get_data()['p']);
                } else {
                    console.log('window.goatcounter object exists, but get_data method NOT YET available.');
                    // Keep checking for a short while
                }
            } else {
                console.log('window.goatcounter object NOT YET available.');
            }
        }, 500); // Check every 500ms

        // Set a timeout 
        setTimeout(function () {
            if (t1) { // If interval is still running
                clearInterval(t1);
                if (!goatcounterInitialized) { // And we never found get_data
                    console.warn('GoatCounter get_data not found after 5 seconds. Trying manual path.');
                    // Fallback: Try using location.pathname if goatcounter object exists
                    if (window.goatcounter) {
                        // Use location.pathname, remove trailing slash if it's not the root
                        let manualPath = location.pathname;

                        // *** NEW: If path is /index.html, try using / instead ***
                        if (manualPath.toLowerCase() === '/index.html') {
                            console.log('Path was /index.html, trying / instead.');
                            manualPath = '/';
                        } else if (manualPath !== '/' && manualPath.endsWith('/')) {
                            // Remove trailing slash for other paths (unless it's the root)
                            manualPath = manualPath.slice(0, -1);
                        }

                        console.log('Using manual path:', manualPath);
                        fetchGoatCounterCount(manualPath);
                    } else {
                        console.error('GoatCounter object never found after 5 seconds.');
                        if (document.querySelector('#visitor-count').innerText === 'Loading...') {
                            document.querySelector('#visitor-count').innerText = 'Error (timeout)';
                        }
                    }
                }
            }
        }, 5000); // Shortened timeout to 5 seconds for fallback

    </script>
</body>

</html>